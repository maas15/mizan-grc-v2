{% extends "base.html" %}
{% block content %}
<style>
/* LOGIN PAGE ‚Äî Pre-Production Design with Alive Animations */
.login-page{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;padding:2rem}
.login-page.rtl{direction:rtl}
.login-bg{position:fixed;inset:0;z-index:0;background:linear-gradient(135deg,#0a0f1c 0%,#0d1b2a 25%,#1b2838 50%,#162032 75%,#0a0f1c 100%);background-size:400% 400%;animation:gradShift 15s ease infinite}
@keyframes gradShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.login-bg::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(102,126,234,.03)1px,transparent 1px),linear-gradient(90deg,rgba(102,126,234,.03)1px,transparent 1px);background-size:40px 40px;animation:gridPulse 8s ease-in-out infinite}
@keyframes gridPulse{0%,100%{opacity:.4}50%{opacity:.8}}
.orb{position:fixed;border-radius:50%;z-index:0;pointer-events:none;filter:blur(80px);opacity:.3}
.orb-1{width:400px;height:400px;background:radial-gradient(circle,#667eea,transparent 70%);top:-10%;left:-5%;animation:oF1 20s ease-in-out infinite}
.orb-2{width:350px;height:350px;background:radial-gradient(circle,#764ba2,transparent 70%);bottom:-5%;right:-5%;animation:oF2 25s ease-in-out infinite}
.orb-3{width:250px;height:250px;background:radial-gradient(circle,#43b89c,transparent 70%);top:40%;right:15%;animation:oF3 18s ease-in-out infinite}
.orb-4{width:200px;height:200px;background:radial-gradient(circle,#f093fb,transparent 70%);bottom:20%;left:10%;animation:oF4 22s ease-in-out infinite}
@keyframes oF1{0%,100%{transform:translate(0,0)scale(1)}33%{transform:translate(60px,40px)scale(1.1)}66%{transform:translate(-30px,80px)scale(.9)}}
@keyframes oF2{0%,100%{transform:translate(0,0)scale(1)}33%{transform:translate(-50px,-50px)scale(1.15)}66%{transform:translate(40px,-20px)scale(.85)}}
@keyframes oF3{0%,100%{transform:translate(0,0)scale(1)}50%{transform:translate(-40px,30px)scale(1.2)}}
@keyframes oF4{0%,100%{transform:translate(0,0)}33%{transform:translate(30px,-40px)}66%{transform:translate(-20px,20px)}}
.particle{position:fixed;width:3px;height:3px;background:rgba(102,126,234,.4);border-radius:50%;z-index:0;pointer-events:none}
.particle:nth-child(odd){animation:pRise 12s linear infinite}
.particle:nth-child(even){animation:pRise 16s linear infinite reverse}
@keyframes pRise{0%{transform:translateY(100vh)scale(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-10vh)scale(1);opacity:0}}
.login-container{position:relative;z-index:10;width:100%;max-width:440px;background:rgba(15,23,42,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(102,126,234,.15);border-radius:24px;padding:2.5rem;box-shadow:0 25px 60px rgba(0,0,0,.4),0 0 80px rgba(102,126,234,.05);animation:cardIn .8s cubic-bezier(.16,1,.3,1) both}
@keyframes cardIn{from{opacity:0;transform:translateY(30px)scale(.95)}to{opacity:1;transform:translateY(0)scale(1)}}
[data-theme="light"] .login-bg{background:linear-gradient(135deg,#e8ecf4 0%,#d5dce8 25%,#c9d4e4 50%,#dde3ee 75%,#e8ecf4 100%);background-size:400% 400%;animation:gradShift 15s ease infinite}
[data-theme="light"] .login-bg::before{background-image:linear-gradient(rgba(102,126,234,.06)1px,transparent 1px),linear-gradient(90deg,rgba(102,126,234,.06)1px,transparent 1px)}
[data-theme="light"] .orb{opacity:.12}
[data-theme="light"] .login-container{background:rgba(255,255,255,.92);border-color:rgba(102,126,234,.12);box-shadow:0 25px 60px rgba(0,0,0,.08)}
[data-theme="light"] .brand-name{background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
[data-theme="light"] .brand-tagline{color:#64748b}
[data-theme="light"] .welcome-box h2{color:#1e293b}
[data-theme="light"] .welcome-box p{color:#64748b}
[data-theme="light"] .auth-tab{color:#64748b;border-bottom-color:transparent}
[data-theme="light"] .auth-tab.active{color:#667eea;border-bottom-color:#667eea}
[data-theme="light"] .auth-form label{color:#374151}
[data-theme="light"] .auth-form input{background:#f1f5f9;border-color:#cbd5e1;color:#1e293b}
[data-theme="light"] .auth-form input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.15)}
[data-theme="light"] .auth-form input::placeholder{color:#94a3b8}
[data-theme="light"] .disclaimer-box{background:rgba(102,126,234,.06);border-color:rgba(102,126,234,.12)}
[data-theme="light"] .disclaimer-text p{color:#475569}
[data-theme="light"] .sensitive-warning{color:#667eea!important}
[data-theme="light"] .lang-btn{color:#64748b;border-color:rgba(100,116,139,.3)}
[data-theme="light"] .lang-btn.active{color:#fff;background:#667eea;border-color:#667eea}
[data-theme="light"] .creator-footer{border-top-color:rgba(0,0,0,.06)}
[data-theme="light"] .created-by{color:#94a3b8}
[data-theme="light"] .creator-name{color:#667eea}
[data-theme="light"] .copyright{color:#94a3b8}
[data-theme="light"] .particle{background:rgba(102,126,234,.15)}
.brand-header{text-align:center;margin-bottom:1.5rem}
.brand-icon{font-size:2.8rem;margin-bottom:.4rem;animation:iconPulse 3s ease-in-out infinite}
@keyframes iconPulse{0%,100%{transform:scale(1);filter:drop-shadow(0 0 8px rgba(102,126,234,.3))}50%{transform:scale(1.05);filter:drop-shadow(0 0 16px rgba(102,126,234,.5))}}
.brand-name{font-size:2rem;font-weight:800;letter-spacing:3px;background:linear-gradient(135deg,#667eea 0%,#a78bfa 50%,#667eea 100%);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:shimmer 4s linear infinite}
@keyframes shimmer{0%{background-position:0% center}100%{background-position:200% center}}
.brand-tagline{font-size:.8rem;color:rgba(148,163,184,.8);letter-spacing:2px;text-transform:uppercase;margin-top:.25rem}
.login-theme-toggle .theme-toggle{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);color:#a78bfa;border-radius:10px;padding:.5rem .7rem;cursor:pointer;transition:all .3s}
.login-theme-toggle .theme-toggle:hover{background:rgba(102,126,234,.15)}
.lang-toggle{display:flex;gap:.5rem;justify-content:center;margin-bottom:1.2rem}
.lang-btn{padding:.35rem .9rem;border-radius:8px;border:1px solid rgba(255,255,255,.12);color:rgba(148,163,184,.8);text-decoration:none;font-size:.82rem;transition:all .3s}
.lang-btn:hover{border-color:rgba(102,126,234,.3);color:#a78bfa}
.lang-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);color:white;border-color:transparent}
.alert{padding:.75rem 1rem;border-radius:10px;margin-bottom:1rem;font-size:.85rem;display:flex;align-items:center;gap:.5rem;animation:slideDown .3s ease}
.alert-error{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.25);color:#fca5a5}
.alert-success{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.25);color:#86efac}
[data-theme="light"] .alert-error{background:rgba(239,68,68,.08);color:#dc2626;border-color:rgba(239,68,68,.2)}
[data-theme="light"] .alert-success{background:rgba(34,197,94,.08);color:#16a34a;border-color:rgba(34,197,94,.2)}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.welcome-box{text-align:center;margin-bottom:1.2rem}
.welcome-box h2{font-size:1.2rem;font-weight:600;color:#e2e8f0;margin-bottom:.3rem}
.welcome-box p{font-size:.82rem;color:rgba(148,163,184,.7)}
.disclaimer-box{background:rgba(102,126,234,.06);border:1px solid rgba(102,126,234,.1);border-radius:12px;padding:.8rem 1rem;margin-bottom:1.2rem}
.disclaimer-content{display:flex;gap:.7rem;align-items:flex-start}
.disclaimer-icon{font-size:1.3rem;flex-shrink:0;margin-top:2px}
.disclaimer-text p{font-size:.78rem;color:rgba(148,163,184,.7);margin:0 0 .3rem;line-height:1.4}
.sensitive-warning{color:rgba(102,126,234,.8)!important;font-weight:500;display:flex;align-items:center;gap:.3rem}
.auth-tabs{display:flex;border-bottom:1px solid rgba(255,255,255,.08);margin-bottom:1.5rem}
[data-theme="light"] .auth-tabs{border-bottom-color:rgba(0,0,0,.08)}
.auth-tab{flex:1;padding:.7rem;background:none;border:none;color:rgba(148,163,184,.6);font-size:.9rem;font-weight:500;cursor:pointer;transition:all .3s;border-bottom:2px solid transparent;display:flex;align-items:center;justify-content:center;gap:.4rem}
.auth-tab:hover{color:rgba(167,139,250,.8)}
.auth-tab.active{color:#a78bfa;border-bottom-color:#667eea}
.auth-form{animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.form-group{margin-bottom:1rem}
.form-group label{display:block;font-size:.82rem;color:rgba(148,163,184,.8);margin-bottom:.4rem;font-weight:500}
.form-group label i{margin-right:.3rem;width:14px;text-align:center}
.rtl .form-group label i{margin-right:0;margin-left:.3rem}
.form-group input{width:100%;padding:.7rem .9rem;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);color:#e2e8f0;font-size:.9rem;transition:all .3s;box-sizing:border-box}
.form-group input::placeholder{color:rgba(148,163,184,.4)}
.form-group input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.12);background:rgba(255,255,255,.06)}
.btn-primary.btn-block{width:100%;padding:.75rem;border:none;border-radius:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:.5rem;margin-top:.5rem}
.btn-primary.btn-block:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(102,126,234,.3)}
.btn-primary.btn-block:active{transform:translateY(0)}
.password-strength{display:flex;align-items:center;gap:.5rem;margin-top:.4rem}
.strength-label{font-size:.72rem;font-weight:600;white-space:nowrap}
.creator-footer{text-align:center;margin-top:1.5rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.05)}
.created-by{font-size:.72rem;color:rgba(148,163,184,.4);margin:0}
.creator-name{font-size:.78rem;color:rgba(167,139,250,.6);font-weight:500;margin:.2rem 0}
.copyright{font-size:.68rem;color:rgba(148,163,184,.3);margin:0}
</style>

<div class="login-page {{ 'rtl' if is_rtl else '' }}">
    <div class="login-bg"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="orb orb-4"></div>
    <div class="particle" style="left:10%;animation-delay:0s;animation-duration:14s"></div>
    <div class="particle" style="left:20%;animation-delay:2s;animation-duration:18s"></div>
    <div class="particle" style="left:35%;animation-delay:4s;animation-duration:12s"></div>
    <div class="particle" style="left:50%;animation-delay:1s;animation-duration:16s"></div>
    <div class="particle" style="left:65%;animation-delay:3s;animation-duration:20s"></div>
    <div class="particle" style="left:80%;animation-delay:5s;animation-duration:15s"></div>
    <div class="particle" style="left:90%;animation-delay:2.5s;animation-duration:13s"></div>

    <div class="login-theme-toggle" style="position:fixed;top:1.2rem;right:1.2rem;z-index:50">
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme"><i class="fas fa-sun"></i></button>
    </div>

    <div class="login-container">
        <div class="brand-header">
            <div class="brand-icon">‚öñÔ∏è</div>
            <div class="brand-name">{{ txt.app_name }}</div>
            <div class="brand-tagline">{{ txt.tagline }}</div>
        </div>

        <div class="lang-toggle">
            <a href="{{ url_for('login', lang='en') }}" class="lang-btn {{ 'active' if lang == 'en' else '' }}">English</a>
            <a href="{{ url_for('login', lang='ar') }}" class="lang-btn {{ 'active' if lang == 'ar' else '' }}">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
        </div>

        {% set flashed = get_flashed_messages(with_categories=true) %}
        {% if flashed %}
        {% for category, message in flashed %}
        <div class="alert {{ 'alert-error' if category == 'error' else 'alert-success' }}">
            <i class="fas {{ 'fa-exclamation-circle' if category == 'error' else 'fa-check-circle' }}"></i> {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        <script>var _flashCtx={{ flashed|tojson|safe }};</script>

        <div class="welcome-box">
            <h2>{{ txt.welcome }}</h2>
            <p>{{ txt.welcome_sub }}</p>
        </div>

        <div class="disclaimer-box">
            <div class="disclaimer-content">
                <div class="disclaimer-icon">üîí</div>
                <div class="disclaimer-text">
                    <p>{{ txt.disclaimer }}</p>
                    <p class="sensitive-warning"><i class="fas fa-shield-alt"></i> {{ txt.no_sensitive }}</p>
                </div>
            </div>
        </div>

        <script>
        function showAuthTab(tab,btn){
            document.querySelectorAll('.auth-tab').forEach(function(t){t.classList.remove('active')});
            btn.classList.add('active');
            document.getElementById('login-form').style.display=tab==='login'?'block':'none';
            document.getElementById('register-form').style.display=tab==='register'?'block':'none';
        }
        </script>
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="showAuthTab('login',this)" id="tab-login">
                <i class="fas fa-sign-in-alt"></i> {{ txt.login }}
            </button>
            <button class="auth-tab" onclick="showAuthTab('register',this)" id="tab-register">
                <i class="fas fa-user-plus"></i> {{ txt.register }}
            </button>
        </div>

        <form id="login-form" class="auth-form" method="POST" action="{{ url_for('login', lang=lang) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label><i class="fas fa-user"></i> {{ txt.username }}</label>
                <input type="text" name="username" placeholder="{{ txt.username }}" required autocomplete="username" maxlength="50">
            </div>
            <div class="form-group">
                <label><i class="fas fa-lock"></i> {{ txt.password }}</label>
                <input type="password" name="password" placeholder="{{ txt.password }}" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn btn-primary btn-block"><i class="fas fa-sign-in-alt"></i> {{ txt.login }}</button>
        </form>

        <form id="register-form" class="auth-form" method="POST" action="{{ url_for('register') }}" style="display:none">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label><i class="fas fa-user"></i> {{ txt.username }}</label>
                <input type="text" name="username" placeholder="{% if is_rtl %}ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (3-50 ÿ≠ÿ±ŸÅ){% else %}Username (3-50 characters){% endif %}" required autocomplete="username" maxlength="50" pattern="[a-zA-Z0-9_]{3,50}">
            </div>
            <div class="form-group">
                <label><i class="fas fa-envelope"></i> {% if is_rtl %}ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä{% else %}Email{% endif %}</label>
                <input type="email" name="email" placeholder="{% if is_rtl %}ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä){% else %}Email (optional){% endif %}" autocomplete="email">
            </div>
            <div class="form-group">
                <label><i class="fas fa-lock"></i> {{ txt.password }}</label>
                <input type="password" name="password" id="reg-password" placeholder="{% if is_rtl %}ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± (8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ){% else %}Password (min 8 chars, upper+lower+number){% endif %}" required autocomplete="new-password" minlength="8">
                <div class="password-strength" id="pw-strength" style="display:none">
                    <div style="flex:1;height:4px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden">
                        <div class="strength-bar" id="pw-bar" style="width:0%;height:100%;transition:all .3s;border-radius:2px"></div>
                    </div>
                    <span class="strength-label" id="pw-label"></span>
                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-block"><i class="fas fa-user-plus"></i> {{ txt.register }}</button>
        </form>

        <div class="creator-footer">
            <p class="created-by">{{ txt.created_by }}</p>
            <p class="creator-name">{{ config.CREATOR_NAME_AR if is_rtl else config.CREATOR_NAME }}</p>
            <p class="copyright">¬© {{ config.COPYRIGHT_YEAR }} {{ config.APP_NAME }} v{{ config.APP_VERSION }}</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
var regPw=document.getElementById('reg-password');
if(regPw){regPw.addEventListener('input',function(){
    var v=this.value,el=document.getElementById('pw-strength'),bar=document.getElementById('pw-bar'),label=document.getElementById('pw-label');
    if(!v){el.style.display='none';return}el.style.display='flex';
    var s=0;if(v.length>=8)s++;if(v.length>=12)s++;if(/[A-Z]/.test(v))s++;if(/[0-9]/.test(v))s++;if(/[^A-Za-z0-9]/.test(v))s++;
    var pct=Math.min(s*20,100),colors=['#ef4444','#f97316','#eab308','#22c55e','#22c55e'];
    var labels={{ "['ÿ∂ÿπŸäŸÅ','ŸÖŸÇÿ®ŸàŸÑ','ŸÖÿ™Ÿàÿ≥ÿ∑','ŸÇŸàŸä','ŸÖŸÖÿ™ÿßÿ≤']" if is_rtl else "['Weak','Fair','Medium','Strong','Excellent']" }};
    bar.style.width=pct+'%';bar.style.background=colors[Math.min(s,4)];label.textContent=labels[Math.min(s,4)];label.style.color=colors[Math.min(s,4)];
})}
document.addEventListener('DOMContentLoaded',function(){
    if(window.location.hash==='#register')showAuthTab('register',document.getElementById('tab-register'));
    if(typeof _flashCtx!=='undefined'&&_flashCtx.length>0){
        var hasRegErr=false,hasSuccess=false;
        for(var i=0;i<_flashCtx.length;i++){var msg=_flashCtx[i][1]||'';
            if(msg.indexOf('Account created')!==-1||msg.indexOf('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ°')!==-1)hasSuccess=true;
            else if(msg.indexOf('Username')!==-1||msg.indexOf('email')!==-1||msg.indexOf('assword')!==-1||msg.indexOf('Registration')!==-1||msg.indexOf('limit')!==-1||msg.indexOf('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ')!==-1)hasRegErr=true;
        }
        if(hasSuccess)showAuthTab('login',document.getElementById('tab-login'));
        else if(hasRegErr)showAuthTab('register',document.getElementById('tab-register'));
    }
});
</script>
{% endblock %}
