{% extends "base.html" %}

{% block content %}
<div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar {{ 'sidebar-right' if is_rtl else 'sidebar-left' }}">
        <div class="sidebar-brand">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Mizan Logo" class="sidebar-logo">
        </div>
        <div class="sidebar-controls">
            <div class="sidebar-lang">
                <a href="{{ url_for('dashboard', lang='en') }}" class="lang-btn {{ 'active' if lang == 'en' else '' }}">EN</a>
                <a href="{{ url_for('dashboard', lang='ar') }}" class="lang-btn {{ 'active' if lang == 'ar' else '' }}">ع</a>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme"><i class="fas fa-sun"></i></button>
        </div>
        <div class="user-info">
            <div class="user-avatar"><i class="fas fa-user"></i></div>
            <div class="user-details">
                <span class="user-label">{{ txt.logged_in_as }}</span>
                <span class="user-name">{{ username }}</span>
                {% if session.get('role') == 'admin' %}
                <a href="{{ url_for('admin_dashboard') }}" class="admin-link"><i class="fas fa-crown"></i> Admin</a>
                {% endif %}
            </div>
        </div>
        <nav class="sidebar-nav">
            {% for domain in domains %}
            <a href="{{ url_for('domain_page', domain_name=domain, lang=lang) }}" class="nav-item">
                {% if 'Cyber' in domain or 'سيبراني' in domain %}<i class="fas fa-shield-alt"></i>
                {% elif 'Data' in domain or 'بيانات' in domain %}<i class="fas fa-database"></i>
                {% elif 'AI' in domain or 'ذكاء' in domain %}<i class="fas fa-robot"></i>
                {% elif 'Digital' in domain or 'رقمي' in domain %}<i class="fas fa-digital-tachograph"></i>
                {% else %}<i class="fas fa-globe"></i>{% endif %}
                <span>{{ domain }}</span>
            </a>
            {% endfor %}
            <a href="{{ url_for('document_history', lang=lang) }}" class="nav-item nav-history"><i class="fas fa-folder-open"></i><span>{{ txt.my_documents }}</span></a>
            <a href="{{ url_for('analytics_page', lang=lang) }}" class="nav-item nav-analytics"><i class="fas fa-chart-line"></i><span>{{ txt.analytics }}</span></a>
            <a href="{{ url_for('profile_page', lang=lang) }}" class="nav-item"><i class="fas fa-user-cog"></i><span>{{ txt.profile }}</span></a>
        </nav>
        <div class="ai-status {{ 'connected' if ai_available else 'disconnected' }}">
            <div class="status-dot"></div>
            <span>{{ txt.ai_connected if ai_available else txt.ai_disconnected }}</span>
        </div>
        <a href="{{ url_for('logout') }}" class="logout-btn"><i class="fas fa-sign-out-alt"></i> {{ txt.logout }}</a>
        <div class="sidebar-footer">
            <p class="created-by">{{ txt.created_by }}</p>
            <p class="creator-name">{{ config.CREATOR_NAME_AR if is_rtl else config.CREATOR_NAME }}</p>
            <p class="copyright">© {{ config.COPYRIGHT_YEAR }}</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="main-header">
            <h1><span class="header-icon">⚖️</span> {{ txt.app_name }}</h1>
            <p class="header-tagline">{{ txt.tagline }}</p>
        </header>

        <!-- Stats Cards -->
        <div class="stats-grid" style="grid-template-columns:repeat(5,1fr);">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-chess"></i></div>
                <div class="stat-value">{{ stats.strategies }}</div>
                <div class="stat-label">{{ txt.tabs[0] }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
                <div class="stat-value">{{ stats.policies }}</div>
                <div class="stat-label">{{ txt.tabs[1] }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clipboard-check"></i></div>
                <div class="stat-value">{{ stats.audits }}</div>
                <div class="stat-label">{% if is_rtl %}التدقيق{% else %}Audits{% endif %}</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-value">{{ stats.risks }}</div>
                <div class="stat-label">{{ txt.tabs[3] }}</div>
            </div>
            <div class="stat-card" style="background:linear-gradient(135deg,rgba(99,102,241,0.15),rgba(139,92,246,0.1));">
                <div class="stat-icon" style="color:#8b5cf6;"><i class="fas fa-layer-group"></i></div>
                <div class="stat-value">{{ stats.total }}</div>
                <div class="stat-label">{{ txt.total_documents }}</div>
            </div>
        </div>

        <!-- Quick Actions + Recent Docs -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem;">
            <!-- Quick Actions -->
            <div class="stat-card" style="padding:1.5rem;">
                <h3 style="margin-bottom:1rem;font-size:1rem;"><i class="fas fa-bolt"></i> {{ txt.quick_actions }}</h3>
                <div style="margin-bottom:0.75rem;">
                    <select id="quick-domain" style="width:100%;padding:0.6rem 1rem;border-radius:8px;border:1px solid var(--border-color,rgba(255,255,255,0.1));background:var(--input-bg,rgba(255,255,255,0.05));color:var(--text-primary,#e2e8f0);font-size:0.9rem;">
                        {% for domain in domains %}
                        <option value="{{ domain }}">{{ domain }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;">
                    <a href="#" onclick="goToDomain('strategy')" class="btn btn-primary" style="text-align:center;font-size:0.85rem;padding:0.7rem;">
                        <i class="fas fa-chess"></i> {{ txt.new_strategy }}
                    </a>
                    <a href="#" onclick="goToDomain('policy')" class="btn btn-secondary" style="text-align:center;font-size:0.85rem;padding:0.7rem;">
                        <i class="fas fa-file-alt"></i> {{ txt.new_policy }}
                    </a>
                    <a href="#" onclick="goToDomain('audit')" class="btn btn-secondary" style="text-align:center;font-size:0.85rem;padding:0.7rem;">
                        <i class="fas fa-clipboard-check"></i> {{ txt.new_audit }}
                    </a>
                    <a href="#" onclick="goToDomain('risk')" class="btn btn-secondary" style="text-align:center;font-size:0.85rem;padding:0.7rem;">
                        <i class="fas fa-exclamation-triangle"></i> {{ txt.new_risk }}
                    </a>
                </div>
                <div style="display:flex;gap:0.75rem;margin-top:0.75rem;">
                    <a href="{{ url_for('export_all_documents') }}" class="btn btn-secondary" style="flex:1;text-align:center;font-size:0.85rem;padding:0.7rem;">
                        <i class="fas fa-download"></i> {{ txt.export_all }}
                    </a>
                    <a href="{{ url_for('profile_page', lang=lang) }}" class="btn btn-secondary" style="flex:1;text-align:center;font-size:0.85rem;padding:0.7rem;">
                        <i class="fas fa-user-cog"></i> {{ txt.profile }}
                    </a>
                </div>
            </div>

            <!-- Recent Documents -->
            <div class="stat-card" style="padding:1.5rem;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
                    <h3 style="font-size:1rem;"><i class="fas fa-clock"></i> {{ txt.recent_documents }}</h3>
                    <a href="{{ url_for('document_history', lang=lang) }}" style="font-size:0.8rem;color:var(--accent,#6366f1);text-decoration:none;">{{ txt.view_all }} →</a>
                </div>
                {% if recent_docs %}
                <div style="display:flex;flex-direction:column;gap:0.5rem;">
                    {% for doc in recent_docs %}
                    <div style="display:flex;align-items:center;justify-content:space-between;padding:0.6rem 0.75rem;border-radius:8px;background:var(--input-bg,rgba(255,255,255,0.03));font-size:0.85rem;">
                        <div style="display:flex;align-items:center;gap:0.6rem;">
                            <i class="fas {% if doc.type == 'strategy' %}fa-chess{% elif doc.type == 'policy' %}fa-file-alt{% elif doc.type == 'audit' %}fa-clipboard-check{% else %}fa-exclamation-triangle{% endif %}" style="color:var(--accent,#6366f1);width:16px;"></i>
                            <span>{{ doc.type|capitalize }}</span>
                            <span style="color:var(--text-muted,#94a3b8);font-size:0.75rem;">{{ doc.domain[:15] if doc.domain else '' }}</span>
                        </div>
                        <span style="color:var(--text-muted,#94a3b8);font-size:0.75rem;">{{ doc.created_at[:10] if doc.created_at else '' }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color:var(--text-muted,#94a3b8);text-align:center;padding:1.5rem 0;font-size:0.9rem;">{{ txt.no_documents }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Usage + Domains -->
        <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1rem;">
            <div style="padding:0.5rem 1rem;border-radius:8px;background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.2);font-size:0.85rem;color:var(--accent,#6366f1);">
                <i class="fas fa-th-large"></i> {{ txt.domains_active }}: <strong>{{ active_domains }}</strong> / 5
            </div>
        </div>

        <!-- Domain Cards -->
        <h2 class="section-title"><i class="fas fa-th-large"></i> {% if is_rtl %}اختر المجال{% else %}Select Domain{% endif %}</h2>
        <div class="domain-grid">
            {% for domain in domains %}
            <a href="{{ url_for('domain_page', domain_name=domain, lang=lang) }}" class="domain-card">
                <div class="domain-icon">
                    {% if 'Cyber' in domain or 'سيبراني' in domain %}<i class="fas fa-shield-alt"></i>
                    {% elif 'Data' in domain or 'بيانات' in domain %}<i class="fas fa-database"></i>
                    {% elif 'AI' in domain or 'ذكاء' in domain %}<i class="fas fa-robot"></i>
                    {% elif 'Digital' in domain or 'رقمي' in domain %}<i class="fas fa-digital-tachograph"></i>
                    {% else %}<i class="fas fa-globe"></i>{% endif %}
                </div>
                <h3 class="domain-name">{{ domain }}</h3>
                <p class="domain-desc">{% if is_rtl %}انقر للدخول إلى أدوات {{ domain }}{% else %}Click to access {{ domain }} tools{% endif %}</p>
                <div class="domain-arrow"><i class="fas fa-arrow-{{ 'left' if is_rtl else 'right' }}"></i></div>
            </a>
            {% endfor %}
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
function goToDomain(tab) {
    const domain = document.getElementById('quick-domain').value;
    const lang = '{{ lang }}';
    window.location.href = '/domain/' + encodeURIComponent(domain) + '?lang=' + lang + '&tab=' + tab;
}
</script>
{% endblock %}
